{###########################################################################}
{# Compose email view.                                                     #}
{#                                                                         #}
{# CONTEXT:                                                                #}
{# - `destination_name`: name of the mail destination                      #}
{# - `form`                                                                #}
{# - `variables`                                                           #}
{#                                                                         #}
{# INHERITED CONTEXT:                                                      #}
{# - `conference`                                                          #}
{# - `next`: URL where to go after this preview is closed.                 #}
{###########################################################################}
{% extends "chair/base/preview_page.html" %}
{% load bootstrap4 %}
{% load static %}

{% block panelTitle %}
  Compose message to {{ destination_name }}
{% endblock %}

{% block css %}
  <link rel="stylesheet" href="{% static 'codemirror/lib/codemirror.css' %}">
  <link rel="stylesheet" href="{% static 'codemirror/theme/monokai.css' %}">
  <link rel="stylesheet" href="{% static 'codemirror/addon/scroll/simplescrollbars.css' %}">
{#<link rel="stylesheet" href="https://unpkg.com/easymde/dist/easymde.min.css">#}
{% endblock %}

{% block content %}
  <form action="" id="newMessageForm" method="POST" novalidate>
    {% csrf_token %}
    <input type="hidden" name="next" id="id_next" value="{{ next }}">
    <div class="form-group">
      {% bootstrap_field form.subject show_label=False %}
    </div>
    <div class="form-group">
      <label for="id_body">
        Enter message text in <a href="https://en.wikipedia.org/wiki/Markdown#Example" target="_blank">Markdown</a>:
      </label>
      {% bootstrap_field form.body %}
      <div class="form-text text-muted dccn-text-small">
        <p>
          You can use variables, e.g. <strong>{% verbatim %}{{ var }}{% endverbatim %}</strong>.
          <a href="#availableVars" data-toggle="collapse">Show available variables...</a>
        </p>
        <ul class="collapse" id="availableVars">
          {% for var in variables %}
            <li><span class="text-info font-weight-bold">{{ var.0 }}</span>: {{ var.1 }}</li>
          {% endfor %}
        </ul>
      </div>
    </div>
    <div class="form-group d-flex">
      <button type="submit" class="btn btn-primary" id="sendMessageButton">Send message</button>
      <a href="{{ next }}" class="btn btn-outline-secondary ml-auto">Cancel</a>
    </div>
  </form>
{% endblock %}

{% block script %}
{#<script src="https://unpkg.com/easymde/dist/easymde.min.js"></script>#}
<script>
/*
var easyMDE = new EasyMDE({
  element: document.getElementById('id_body'),
  spellChecker: false
});
 */
</script>
<script src="{% static 'codemirror/lib/codemirror.js' %}"></script>
<script src="{% static 'codemirror/addon/scroll/simplescrollbars.js' %}"></script>
<script src="{% static 'scripts/require.js' %}" data-main="{% static '' %}"></script>
<script>
$(document).ready(function () {
  requirejs([
    'codemirror/lib/codemirror', 'codemirror/mode/markdown/markdown', 'codemirror/addon/scroll/simplescrollbars'
  ], function (CodeMirror) {
    CodeMirror.fromTextArea(document.getElementById('id_body'), {
      mode: 'markdown',
      theme: 'monokai',
      highlightFormatting: true,
      scrollbarStyle: "simple",
      lineWrapping: true,
    });
  });
});
</script>
{% endblock %}

